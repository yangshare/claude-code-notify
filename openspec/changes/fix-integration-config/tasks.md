# 实施任务清单

## 1. 配置文件路径修复
- [x] 1.1 修改 `IntegrationManager::detect_config_path` 统一使用 `~/.claude/settings.json`
- [x] 1.2 移除错误的 `config.json` 文件名检测
- [x] 1.3 修正 Windows 平台路径检测逻辑（移除 `%APPDATA%\Claude\` 优先检测）
- [x] 1.4 添加 `CLAUDE_CONFIG_DIR` 环境变量支持
- [x] 1.5 添加配置文件存在性验证和友好的错误提示

## 2. Windows PATH 环境变量管理
- [x] 2.1 实现 `add_to_path` 函数：将 ccn.exe 所在目录添加到用户 PATH
- [x] 2.2 实现 `remove_from_path` 函数：从用户 PATH 中移除 ccn.exe 目录
- [x] 2.3 在 `ccn setup` 命令中集成 PATH 添加逻辑
- [x] 2.4 在 `ccn uninstall` 命令中集成 PATH 移除逻辑
- [x] 2.5 添加 PATH 修改的成功/失败提示和日志记录

## 3. 集成流程改进
- [x] 3.1 修改 `setup` 命令执行顺序：先配置 PATH，再注入 hooks
- [x] 3.2 修改 `uninstall` 命令执行顺序：先移除 hooks，再清理 PATH
- [ ] 3.3 添加集成验证：测试 hooks 命令是否可执行
- [x] 3.4 改进用户提示：告知用户需要重启终端或 VS Code 使 PATH 生效

## 4. 测试与验证
- [ ] 4.1 手动测试：Windows 上配置文件路径检测是否正确
- [ ] 4.2 手动测试：`ccn setup` 后 PATH 是否正确添加
- [ ] 4.3 手动测试：`ccn uninstall` 后 PATH 是否正确移除
- [ ] 4.4 集成测试：验证 hooks 在 Claude Code 中是否正常触发
- [ ] 4.5 回归测试：确保现有通知功能不受影响

## 5. 文档更新
- [ ] 5.1 更新 README：说明 Windows 上需要重启终端使 PATH 生效
- [ ] 5.2 更新故障排查章节：添加配置文件路径相关问题的解决方案
- [ ] 5.3 更新变更日志：记录此次修复的内容

## 依赖关系说明
- 任务 1 可以独立完成（配置文件路径修复）
- 任务 2 依赖任务 1 完成（PATH 管理需要在正确的配置路径基础上）
- 任务 3 依赖任务 1 和 2（集成流程需要所有修复到位）
- 任务 4 依赖任务 1-3（测试需要所有功能完成）
- 任务 5 可以与任务 1-4 并行进行

## 可并行工作流
**第一阶段**：任务 1（配置文件路径修复）必须首先完成 ✅
**第二阶段**：任务 2（PATH 管理）和任务 5（文档更新）可并行 ✅
**第三阶段**：任务 3（集成流程改进）依赖第二阶段 ✅
**第四阶段**：任务 4（测试与验证）依赖第三阶段 ⏳
